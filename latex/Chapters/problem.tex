% Chapter 3 - Description of problem

\chapter{Application of nek5000 and the creation of grid} % Main chapter title

\label{problem} % Change X to a consecutive number; for referencing this chapter elsewhere, use \ref{ChapterX}

\lhead{Chapter 3. \emph{application of nek}} % Change X to a consecutive number; this is for the header on each page - perhaps a shortened title

%----------------------------------------------------------------------------------------
%	SECTION 1
%----------------------------------------------------------------------------------------
\section{Nek5000}

There are many numerical solvers for turbulent flows available on the market. From large commercial softwares such as fluent which runs as a 
black-box solver, to CDP which is a bit more specialized solver with the posibility to modify the code to apply it to the wanted usage and 
to full open-source codes such as nek5000 and openFOAM. The solvers can vary both in the fundamental numerical method (FV,FD,FEM,SEM) 
the implemented algorithm (Fractional Step, Poisson pressure, Uzawa) and the type of simulation (RANS,LES,DNS). 
The software is chosen depending on the users requirement, but the work flow does follow a certain structure in all cases. 

\begin{itemize}
	\item Practical problem --> Mathematical formulation --> Generation of mesh --> Simulation --> post-processing
\end{itemize}
An example is waterflow in a channel, which would be the practical problem. The mathematical formulation would be the incompressible N-S eq, 
with LES dynamical SGS. The mesh could consist of tetrahedros or hexahedrons. The simulation is the performed on some cluster before the 
wanted data in some sub-domain is visualized and presented. 

Nek provides a basic tool for generation of mesh. For more complex geometries this tool cannot compare with more visualized-based softwares 
such as ICEM from ANSYS which exports mesh to several numerical solvers such as Fluent and nastran.
It is therefore very useful to have an automatic way of converting a mesh created in ICEM to the format required by nek5000. 
In order for nek to run optimally the elements should be as homogenous and as similar to the reference element as possible. 
It is therefore of great interest to be able to propagate curved geometries into the neighbour-elements in order to have a smooth as 
possible transition from a boundary with high curvature.

\section{Gas dispersion in a simplified urban area}
The problem investigated in this work is gas dispersion of neutral gas in a velocity field through four cubic blocks.
Similar simulations have been done in CDP and Fluent which are compared to data from a wind-tunnel experiment performed by ALAN.
\begin{itemize}
	\item Description of problem and domain
	\item mesh and fluent/CDP mesh
\end{itemize}

\section{Creation of the mesh-convertion script}
The routine xyzarc:

The gordon hall algorithm was already implemented as a function in Nek, with the gll-points,plynomial degree and some initial 
coordinates to the element. The algorithm creates a distribution of the internal gll-points in each element. 
If the element consists of linear edges the only necessary input are the vertices, but by specifying the points on edges and faces
the algorithm creates a logical distribution of the internal GLL-points to a deformed element. 

The curved edge is specified in the .rea file and the routine genxyz() processes the input of each edge. 
By specifying the radius and the circle center genxyz calls the routine xyzarc() which performs the following algorithm;

    $a,b$ will be the two endnodes of the edge 
    $c$ will be the midnode, $s$ will be the arc length, $theta$ will be the full angle of the circle sector, $cc$ is the center coordinates.
    $g$ will be the vector containing the GLL-points in $[-1,1]$. $r$ will be the radius.
\begin{lstlisting}
 l = a-b                    # vector between the corner nodes
 c = (a+b)/2                # midpoint location
 h = c-cc                   # height of the framed triangle
 theta = arctan(|l|/2|h|)   # half the angle of the circle sector
 s = r*theta                # arclength
 g' = g*theta               # angles to the gll-points on the circle-sector
 # Finding the intersecting points
 # x on the line l, and extend x-cc to the arc 
 for k in range(lx1):       # For the number of nodes in one direction
    alpha = h*tan(g[k])     # Offset from the midpoint on l
    x = c-alpha*l/|l|       # Actual coordinate on l
    m = x-cc                # hypothenus of the imposed triangle
    edge(k) = cc+r*m/|m|    # final coordinate on the arc
\end{lstlisting}
These lines creates the wanted egde curved as a circle sector corresponding to the radius and circle center given.
The remaining operation is to call the gordon hall algorithm and create the internal GLL-points defined by the edges 
provided.


\begin{itemize}
		\item reading radius, and center
		\item finding the angular offset to match the gll-points
		\item finding the points on the linear edge
		\item projecting them on the surface
\end{itemize}
\begin{itemize}
	\item initial script
	\item changes and modifications
	\item performance testing
	\item pitfalls
\end{itemize}

<<<<<<< HEAD

=======
>>>>>>> b0e85fa08b5b58c1f2e46fe949c31decaa0b5a6f
