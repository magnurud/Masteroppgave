% Chapter 2 - physics theory

\chapter{Problem description} % Main chapter title

\label{physics} % Change X to a consecutive number; for referencing this chapter elsewhere, use \ref{ChapterX}

\lhead{Chapter 2. \emph{background on fluid dynamics}} % Change X to a consecutive number; this is for the header on each page - perhaps a shortened title

%----------------------------------------------------------------------------------------
%	SECTION 1
%----------------------------------------------------------------------------------------
\section{The Incompressible Navier-Stokes equation}

The physics regarding fluids in motion are described mathematically by the Navier-Stokes equation. 
The equations can be derived in many ways, and it is referred to \cite{White} for a complete derivation.
The general idea is to conserve momentum and mass in a control domain providing a system of two equations.
In this thesis only the incompressible N-S equation will be considered, 
with the assumption of an incompressible flow the conservation of mass 
results in a divergence free restriction on the solution $u$.
Without further introduction the incompressible  N-S equations are stated as  
%
\begin{align}
    \begin{split}
    \frac{\partial \mathbf{u}}{\partial t} + \mathbf{u}\cdot \nabla\mathbf{u} &= 
    \mathbf{f} + \nabla \cdot \tau, \\
		\nabla \cdot \mathbf{u} &= 0.
    \end{split}
	\label{eq:NS}
\end{align}
%
These equations have been studied for centuries and different physical situations
lead to different simplifications and sets of equations.
Examples are the Euler equations,
Stokes problem and darcy flow.
In particular the Stokes problem is applied a lot as an initial test of the full N-S problem. 
Before attempting to solve these equations it is important to understand the role of each term 
and their mathematical influence on the problem. 
\begin{itemize}
    \item $\partial \mathbf{u} /\partial t$
     - The time-derivative of the flow, for a steady state flow this term will be equal zero.
             The discretization of this term is often based on some implicit scheme in order to improve stability.  
    \item $\mathbf{u} \cdot \nabla \mathbf{u}$
     - The convective term, describes the transport due to the flow itself on each of its components. 
    The term is not present in Stokes problem.
    The mathematical operator corresponding to this term is non-linear and non-symmetric, and does therefore require the equations to be solved 
    by some iteration procedure. Even with linear advection the operator is a source to instability and needs to be handled carefully. 
\item  $\nabla \cdot \tau$ 
       - $\tau= -p + \nu[ \nabla \mathbf{u} + \nabla^T \mathbf{u}]$ is known as the Reynolds stress tensor for incompressible flows.
       The term $\nabla \cdot \tau$ simplifies to $-\nabla p + \nu \Delta \mathbf{u}$ if the viscosity $\nu$
       is assumed to be constant, This is not the case for turbulent flows.
       It is a symmetric tensor, hence another 6 unknows is introduced.
    \item $\nu \Delta \mathbf{u}$ 
    - The diffusive term describes the natural diffusion of the fluid. The effect of diffusion is determined by the 
    viscosity of the fluid. The corresponding mathematical operator stabilizes the system and it is therefore generally easier
    to solve the N-S equations for high-viscosity fluids. 
    \item $\nabla p$
    - The pressure gradient, Removal of this term results in a pure advection diffusion problem.
    \item $\nabla \cdot \mathbf{u}$ 
    - The divergence free condition from the mass equation.
\item $\mathbf{f}$ 
    - General term describing exteternal body forces such as gravity. For incompressible flow the
    gravity term is incorporated in the pressure term, $\nabla p = \nabla p + \rho \mathbf{g}$. 
    \item $Re$ 
    - The Reynolds number defined as $UL/\nu$ where $U$ is the velocity scale, $L$ is the length scale and $\nu$ 
      is the viscosity of the fluid. $Re$ describes the relation between the biggest length scales of the flow
      and the viscous length scales. Notice how for large Reynolds number the unstable non-linear term 
      dominates the transportation.Turbulent flows are characterized by high reynolds number.
\end{itemize}
For large Reynolds number the huge span in length scales requires an extremely fine mesh if the equations \ref{eq:NS} 
are to be solved exactly. Because a fine mesh implies a high computational cost a direct numerical solution (DNS) is not feasible for 
problems of a certain geometrical complexity. There are many different approaches on how to resolve the turbulent term and in 
this thesis the main approach will be through Large Eddy Simulations (LES) which will be discussed 
in the following section.
%
\subsection{Weak formulation of N-S}
Let us first assume constant viscosity, enabling the simplification $\nabla \cdot \tau = -\nabla p + \nu \Delta \mathbf{u}$.
This is a poor approximation for a turbulent flow but it will be clarified in later chapters how this can be expanded
to be valid for more general cases.
The numerical algorithms applied in this thesis requires a weak formulation of equation~\ref{eq:NS}.
Before the weak form is derivated a few operators will be defined in order to simplify the final 
expression.
%
\begin{align}
    ( \mathbf{u},\mathbf{v})_{L_2} &= \int_{\Omega}\mathbf{u} \cdot \mathbf{v} d\Omega\\
    \mathcal{A}(\mathbf{u},\mathbf{v}) &= (\nabla \mathbf{u},\nabla \mathbf{v})_{L_2}\\
    \mathcal{B}(\mathbf{u},p) &= (\nabla \cdot \mathbf{u},p)_{L_2}\\
    \mathcal{C}(\mathbf{w};\mathbf{u},\mathbf{v}) &= (\mathbf{w}\cdot \nabla \mathbf{u},\mathbf{v})_{L_2}
    \label{eq:weakoperators}
\end{align}
%
A weak formulation is obtained by multiplying with a test funcion $\mathbf{v}$ and integrating over
the entire domain.
\begin{align}
    \begin{split}
        \int_{\Omega}\frac{\partial \mathbf{u}}{\partial t}\cdot\mathbf{v}d\Omega
        + \int_{\Omega}(\mathbf{u}\cdot \nabla)\mathbf{u}\cdot\mathbf{v}d\Omega
        &= -\int_{\Omega}\nabla p\cdot \mathbf{v} d\Omega 
        + \nu \int_{\Omega}\Delta\mathbf{u}\cdot\mathbf{v}d\Omega, \\
		\int_{\Omega}(\nabla \cdot \mathbf{u}) \mathbf{q}d\Omega &= 0.
    \end{split}
	\label{eq:NSweak1}
\end{align}
Introducing the compact inner product notation and appling the divergence theorem on the right hand side of 
the first equation yields
\begin{align}
    \begin{split}
        (\frac{\partial \mathbf{u}}{\partial t},\mathbf{v})
        + (\mathbf{u}\cdot \nabla\mathbf{u},\mathbf{v})
        &= -(\nabla \cdot \mathbf{v} , p ) 
        -\nu(\nabla \mathbf{u},\nabla \mathbf{v}), \\
		(\nabla \cdot \mathbf{u},q) &= 0.
    \end{split}
	\label{eq:NSweak}
\end{align}
%Writing the covective term in conservational form $\nabla \cdot \mathbf{u}\mathbf{u}$ and applying the 
%divergence theorem on the terms leaves us with 
%\begin{align}
    %\begin{split}
        %(\frac{\partial \mathbf{u}}{\partial t},\mathbf{v})
        %- (\mathbf{u}\mathbf{u},\nabla \cdot \mathbf{v})
        %&= +(p,\nabla \cdot \mathbf{v} ) 
        %+\frac{1}{Re}(\tau,\nabla \cdot \mathbf{v}), \\
		%-(\mathbf{u},\nabla p) &= 0.
    %\end{split}
	%\label{eq:NSweak}
%\end{align}
Finally, by using the notation introduced in~\ref{eq:weakoperators} the weak formulation of the incompressible
N-S equation can be stated as: 

Find $(\mathbf{u}, p) \in H^1(\Omega)\times L^2(\Omega)$ such that 
\begin{align}
    \begin{split}
        (\frac{\partial \mathbf{u}}{\partial t},\mathbf{v})
        + \mathcal{C}(\mathbf{u};\mathbf{u},\mathbf{v})
        &= -\mathcal{B}(\mathbf{v},p) 
        -\nu\mathcal{A}(\mathbf{u},\mathbf{v}), \\
        \mathcal{B}(\mathbf{u},q) &= 0.
    \end{split}
	\label{eq:NSweak}
\end{align}
$\forall\; (\mathbf{u}, p) \in H^1(\Omega)\times L^2(\Omega)$.


%
\section{The passive scalar equation}
The N-S equation explains how a fluid will behave and solving it provides a complete pressure-velocity field of the 
domain of interest, but it does not provide the answer of how heat will distribute in this flow, or how a gas will spread.
The equation corresponding to this physical problem will be reffered to as the passive scalar equation for any scalar 
$\phi_i$ and is stated as 
\begin{align}
    \begin{split}
        (\rho c_p)_i\frac{\partial \phi_i}{\partial t} + \mathbf{u}\cdot \nabla\phi_i 
        &= \nabla \cdot(k_i\nabla \phi_i)+ (q_{vol})_i.
    \end{split}
	\label{eq:PS}
\end{align}
\colorbox{yellow}{How to explain the constant in this equation ??} 
\section{Resolving the turbulent term using LES}
When DNS is not feasible due to high Reynoldsnumber LES is one of the most powerful tools when it comes to simulating turbulent flows.
The idea is based on the fact that for the small turbulent structures behave independently of time and location and are therefore 
easy to model. This way the larger structures driven by geometry, inflow conditions and external forces can be simulated using a coarser 
grid while the effect of the small structures are modelled. \colorbox{yellow}{Some source on the importance of SGS-model}

\subsection{Filter}
A filter in its general form is given as 
\begin{align}
    \tilde{U}(\mathbf{x},t) = \int_{\Omega} G(\mathbf{r},\mathbf{x})U(\mathbf{x}-\mathbf{r},t)d\mathbf{r}
    \label{eq:filter}
\end{align}

In order to perform a LES a filter width a certain width $\Delta$ has to be chosen, 
the filtered N-S equations are given as 
%
\begin{align}
    \begin{split}
        \frac{\partial \mathbf{\bar{u}}}{\partial t} + \mathbf{\bar{u}}\cdot \nabla\mathbf{\bar{u}}
        &= -\nabla \bar{p} +\nu\Delta \mathbf{\bar{u}}-\nabla \cdot \tau, \\
        \nabla \cdot \mathbf{\bar{u}} &= 0.
    \end{split}
	\label{eq:NSfiltered}
\end{align}
%
Where $\tau$ in this case denotes the subgrid scale (SGS) stress given as 
\begin{align}
    \tau^r_{ij}(u_i,uj) = (u_iu_j)^r -u_i^ru_j^r
    \label{eq:sgstensor}
\end{align}

\subsection{dynamic Smagorinsky-Lilly SGS-model}
The problem is now reduced to modelling this tensor, the most common SGS-model is the 
dynamic Smagorinsky-Lilly model. The initial progress of this model was made by 
Lilly in 1967~\cite{Lilly67} suggesting the following model of the sgs-tensor
%
\begin{align}
    \tau_{ij} &= -2C_dl^2\mathcal{S}^rs_{ij}^r,\\
    s^r_{ij} &= \frac{1}{2}\left( \frac{\partial u^r_i}{\partial x_j} +
    \frac{\partial u^r_j}{\partial x_i}\right)\\,
    \mathcal{S}^r &= \sqrt{2s^r_{ij}s^r_{ij}}.
    \label{eq:boussinesq}
\end{align}
%
Where $l$ denotes the filter width.
The resolved strain rate is easily calculated and the problem is now reduced to determining
the constant $C_d$. There were several attempts to determine this constant for the entire domain,
but finally in 1991~\cite{Germano91} a dynamic subgrid-scale model was presented calculating a 
$C_d$ locally in time and space. The general idea is that the $C_d$ is independent of the 
filter width and from this assumption develope an expression for the dynamical constant.

Let $a,b$ denote two distinct filters with corresponding filter widths $l_a,l_b$. 
Let $\tau_{ij}$ and $T_{ij}$ denote the stresses based on single- and double filtering
operations on the N-S equations
\begin{align}
    \begin{split}
    \tau_{ij} = (u_iu_j)^a - u_i^au_j^a,\\
    T_{ij} = ((u_iu_j)^a)^b - (u_i^a)^b(u_j^a)^b.
    \end{split}
    \label{eq:stresstensors}
\end{align}
%By defining $a_{ij}=l_a^2\mathcal{S}^a = l_a^2\sqrt{2s^{a}_{ij}s^{a}_{ij}}$ the subgrid scale tensor can 
%be written as $\tau^a_{ij} = 2C_da_{ij} $. 
Applying the $b$ filter on the first tensor in eq~\ref{eq:stresstensors} allows us to define 
a new tensor $L_{ij}$ which depends only on the $a$-filtered variables. The identity 
is known as Germanos identity and was first introduced in 1991~\cite{Germano91},
\begin{align}
    L_{ij} = T_{ij} - (\tau_{ij})^b
    = (u_i^au_j^a)^b - (u_i^a)^b(u_j^a)^b.
    \label{eq:germanoid}
\end{align}
Substituting the stress-tensors with their corresponding expression 
from equation~\ref{eq:boussinesq} and assuming a dynamic constant uneffected by the filter 
one obtains an approximation for $L_{ij}$ which is computable,
\begin{align}
    \begin{split}
L_{ij} &\approx 2C_d l_b^2 \mathcal{S}^{ab} s^{ab}_{ij}
        -2 (C_d l_a^2 \mathcal{S}^a s^a_{ij})^b\\
        &\approx 2C_dl_a^2[\lambda\mathcal{S}^{ab}s^{ab}_{ij} 
        - (\mathcal{S}^{a}s^{a}_{ij})^b]\\
        &= 2C_dl_a^2 M_{ij}.
        \label{eq:lillystress}
    \end{split} \\
    M_{ij} &= \lambda^{2}\mathcal{S}^{ab}s_{ij}^{ab} - (\mathcal{S}^as_{ij}^a)^b\\
        \lambda &= (l_b/l_a)^2
    \label{eq:dynsmagderivation}
\end{align}
Minimizing the mean-square error between the exact $L_{ij}$ as expressed in 
equation~\ref{eq:germanoid} and the boussinesq-based approximation 
in~\ref{eq:lillystress} yields the best approximation 
for the dynamic Smagorinsky constant 
%
\begin{align}
    C_d &= \frac{M_{ij}L_{ij}}{2l_a^2\:M_{kl}M_{kl}}.
    \label{eq:dynsmag}
\end{align}
%
Note that the double indices implies summing. This expression is however not a 
stable option and to deal with this most implementations apply some sort of mean 
in either time, space or both when calculating the costant.  

\section{Solution methods of incombressible N-S}
A non-linear set of equations requires a non-trivial solution method, and when the domain of the problem can be anyting from a simple channel 
to a moving turbine there are many considerations that needs to be made. Allthough the equations have been known for over 200 years no one 
has been able to prove or disprove the well-posedness of the problem. FINAL ELEMENT FORMULATION WELL-POSED?? Some of the most common algorithms 
will be discussed in the following subsections

\subsection{Operator-splitting techniques }
Let us considere a simplified transient problem 
\begin{align}
    \frac{du}{dt} = f + g.
    \label{eq:testproblem}
\end{align}
both $f$ and $g$ are functions of $u$ and therefore of $t$ as well. By integrating on both sides one obtains
\begin{align}
    u(s) - u(0) = \int_0^s f dt + \int_0^s g dt.
    \label{eq:testproblemintegrated}
\end{align}
The idea is then to evaluate one of the integrals by an explicit scheme and the other one with an implicit scheme.
A general formulation of this for a timestep would be on the form 
\begin{align}
    u^{n+1}-u^{n} = \sum_{k = 0}^{N} a_k f^{n-k}+\sum_{k = 0}^{N} b_k g^{n-k+1}.
    \label{eq:exp-imp}
\end{align}
In equation~\ref{eq:exp-imp} the first integral in ~\ref{eq:testproblemintegrated} is evaluated by 
an explicit scheme and the second one by an implicit scheme. The coefficients $a_k,b_k$ corresponds to 
the elected scheme. When operator splitting is applied in this thesis an Adam-Bashford scheme is 
chosen for the implicitly evaluated integral while Runge-Kutta is applied for the explicit scheme. 
Operator splitting is a very convenient strategy for 
the N-S equations which consists of the easily invertible laplacian operator 
and the demanding convection operator. 



\subsection{Operator integrating factor schemes (OIFS)}
The operator-splitting method described in the previous chapter may lead to an unstable scheme,
OIFS is a similar method but it offers a more stable scheme. The presentation of the method 
is presented here in a computational fashion, for a full description and derivation of the method 
it is refered to Maday et al~\cite{raey}.

By considering the NS-equation in a general operational form 
\begin{align}
    M\frac{d \mathbf{v}}{dt} + C\mathbf{v} = -K\mathbf{v} +D_i p +Mf_i.
    \label{eq:NSoperator}
\end{align}
Now let us define an operator $Q(t)$ such that $Q(t^{n+1}) = I$ and 

\begin{align}
    \frac{dQ(t)M\mathbf{v}}{dt} &=  Q(t)M\frac{d\mathbf{v}}{dt} + \frac{d}{dt}(Q(t)M)\mathbf{v}.\\
    &= Q(t)M\frac{d\mathbf{v}}{dt} + Q(t)C\mathbf{v} 
   % &= M\frac{d\mathbf{v}}{dt} + C\mathbf{v} \text{  when t = t*. }
    \label{eq:integrationalfactor}
\end{align}
%
This way equation~\ref{eq:NSoperator} can be written as 
\begin{align}
    \frac{d Q(t)M\mathbf{v}}{dt} =Q(t)( -K\mathbf{v} +D p +M\mathbf{f}).
    \label{eq:NSoperatorOIFS}
\end{align}
Evaluating this equation with a BDFk-scheme results in a system 
\begin{align}
    \sum_{j=0}^{k}\beta_jQ(t^{n+1-j})M\mathbf{v}^{n+1-j} =\Delta t \: Q(t^{n+1})( -K\mathbf{v}^{n+1} +D p^{n+1} +M\mathbf{f}^{n+1}).
    \label{eq:NSOIFS1}
\end{align}
Applying the fact that $Q(t^{n+1}) = I$ enables us to write equation~\ref{eq:NSOIFS1} as 
\begin{align}
    \beta_0M\mathbf{v}^{n+1} + \sum_{j=1}^{k}\beta_jQ(t^{n+1-j})M\mathbf{v}^{n+1-j} 
    =\Delta t ( -K\mathbf{v}^{n+1} +D p^{n+1} +M\mathbf{f}^{n+1}).
    \label{eq:NSOIFS1}
\end{align}
Notice how all the easily invertible operators are evaluated implicitly, while the convective non-linear term is hidden in the BDFk scheme. 
Now the OIFS method allows us to find the terms in the sum in a rather elegant fashion.  
First of all the auxiliary variable $\tilde{\mathbf{v}}_j$ is defined such that $Q(t^{n+1-j})M\mathbf{v}^{n+1-j} = M\tilde{\mathbf{v}}_j$ thus enabling us to find
the summation expression by solving the initial value problem 
\begin{align}
    M\frac{d\tilde{\mathbf{v}}_j}{ds} &= -C(\tilde{\mathbf{v}}_j(s))\tilde{\mathbf{v}}_j(s) , \qquad t^{n+1-j}\leq s\leq t^{n+1}\\
    \tilde{\mathbf{v}}_j(t^{n+1-j}) &= \mathbf{v}(t^{n+1-j}).
    \label{eq:IVP}
\end{align}
Notice how the integrational factor $Q(t)$ is never evaluated directly.

The final scheme applied for solving equation~\ref{eq:NSoperator} when applying OIFS consists of one scheme for solving 
equation~\ref{eq:NSOIFS1} and another scheme for solving equation~\ref{eq:IVP}. When applied in this thesis the 
first scheme is an implicit BDFk-scheme while the second is an explicit kth order Runge-Kutta scheme. (4th order ? )
It is important to add that the error induced by this method is non-vanishing and is only recommended for assuring stability 
for very instable problem. (Allows higher CFL number?)

\subsection{Fractional step}
Fractional step is an algorithm that can be divided into four seperate steps. For simplicity let us write the N-S
equation as 
\begin{align}
    \partial_t v = Lv + Dp + Nv.
    \label{eq:NSfracstep}
\end{align}
Where $\partial_t, L,D,P$ Denotes the time-derivate, linear, gradient and non-linear operator. 
The method describing one time-step can then be summarized as following
\begin{itemize}
    \item solve $v^* = v^n + \Delta t Nv^n$.
    \item solve the poisson pressure equation $\Delta\: p = \nabla \cdot (v^*/\Delta t)$.
    \item solve $v^{**} =v^* + \Delta t Dp^{n+1}$.
    \item solve $\partial_t v^{n+1}=v^{**} + \Delta t Lv^{n+1}$.
\end{itemize}
%\begin{itemize}
    %\item solve $dv/dt=Nv$
    %\item solve the poisson pressure equation $\Delta\: p = \nabla \cdot (v^*/\Delta t)$.
    %\item solve $v^{**} =v^* + \Delta t Dp^{n+1}$.
    %\item solve $\partial_t v^{n+1}=v^{**} + \Delta t Lv^{n+1}$.
%\end{itemize}
This method provides an efficient algorithm, but is known to produce errors of order O(1).
The problem is the pressure poisson equation which is solved with incorrect boundary 
conditions. The first step can also be evaluated in an OIFS-way to gain stability, by rewriting the initial equation 
as described in the previous chapter. 

\subsection{Pressure-correction}

%\subsection{Decoupling the pressure} 

%A common way to approach equation~\ref{eq:NS} is to solve the pressure and velocity field
%seperatly. The mathematical reasoning for this approach is obtained by taking the 
%divergence on both sides, 
%\begin{align}
	%\nabla \cdot \frac{\partial \mathbf{u}}{\partial t} + 
    %\nabla \cdot(\mathbf{u} \cdot \nabla) \mathbf{u} 
    %&= -\Delta p + \nu \Delta \tau \\
	%\frac{\partial (\nabla \cdot  \mathbf{u})}{\partial t} + 
    %(\nabla \cdot \mathbf{u}) \cdot \nabla \mathbf{u} 
    %&= -\Delta p + \nu \Delta \tau \\
   %\Delta p &= \nu \Delta \tau \\
	%\label{eq:pressuredecoupling}
%\end{align}

%Where the divergence free criterium is applied to get to the final equation.
